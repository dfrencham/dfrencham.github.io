<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.58.2" />

  <title>solar &middot; DIYDeveloper.io</title>

  
  <link rel="stylesheet" href="/css/bootstrap-social.css">
  <link rel="stylesheet" href="/css/blog.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Vollkorn" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700" rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700,700i,900,900i|Fira+Sans:400,400i,700,700i,900,900i|Quicksand:300,400,500,700" rel="stylesheet" />
  <link href="/css/prism.css" rel="stylesheet" />
  <script src="/js/jquery.min.js"></script>
  <script src='/js/prism.js' type='text/javascript'></script>
  <script src='/js/stackblur.min.js' type='text/javascript'></script>


  
  <link rel="stylesheet" href="/css/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
  <script type="text/javascript" src="/js/jquery.fancybox.pack.js?v=2.1.5"></script>
  <script type='text/javascript'>
   $(document).ready(function() {
      $(".fancybox").fancybox({
      helpers : {
          title: {
              type: 'inside',
              position: 'top'
          }
      },
      nextEffect: 'fade',
      prevEffect: 'fade'});
   });
  </script>

</head>


<body>

<header id="page-header">
    <div class="header title-header">
        <h1><a href="/">DIY Developer</a></h1>
        <h2>Power tools, software, 3d printing</h2>
    </div>
</header>

<section class="content">
  <div class="pure-g post-index">
    <div class="pure-u-1">
      <div class="title-center">
          <h1><i class="fa fa-tags fa-fw"></i> solar</h1>
      </div>
    </div>
    
    <article class="blog-post">
    <div class="post-header">
        <h2><a href="/post/2019-12-2-aurora-inverter/">Aurora Inverter Monitoring Done Quick</a></h2>
    </div>
    <div class="post-meta">

  
  
  
  
  

  
    
    
    
  
  <div class="article-meta">
      
      <div class="social-buttons"> 
            <a class="btn btn-social-icon btn-twitter" href="http://twitter.com/share?url=https%3a%2f%2fdiydeveloper.io%2fpost%2f2019-12-2-aurora-inverter%2f&amp;text=Aurora%20Inverter%20Monitoring%20Done%20Quick&amp;via=dfrencham"><i class="fa fa-twitter"></i></a>
            <a class="btn btn-social-icon btn-facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdiydeveloper.io%2fpost%2f2019-12-2-aurora-inverter%2f&amp;t=Aurora%20Inverter%20Monitoring%20Done%20Quick"><i class="fa fa-facebook"></i></a>
            <a class="btn btn-social-icon btn-linkedin" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdiydeveloper.io%2fpost%2f2019-12-2-aurora-inverter%2f"><i class="fa fa-linkedin"></i></a>  
            <a class="btn btn-social-icon btn-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdiydeveloper.io%2fpost%2f2019-12-2-aurora-inverter%2f&title=Aurora%20Inverter%20Monitoring%20Done%20Quick"><i class="fa fa-reddit"></i></a>      
     </div>
     <div class="tags">
          <div class="taxonomy-tag">             
              <i class="fa fa-calendar fa-fw"></i>            
              <time>03 Dec 2019</time> 
          </div>
          
            
            
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/solar">solar</a>
                </div>
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/linux">linux</a>
                </div>
              
            
          
      </div>
      
  </div>

</div>
    

<p>Last time I set up inverter monitoring for my Aurora solar inverter, it had a lot of moving parts. I had a RaspberryPi ModelB hosting utilities writing to CSV files, which were periodically scooped up by a monitoring service. The monitoring service had a bit of setup and a few issues, but in the end it would get the data up to <a href="http://pvoutput.org">PVOutput.org</a>.</p>

<p>This time around I decided to cut out all the bullshit and write to the PVOutput API with as little fuss as possible.</p>

<p>Note that to set all this up you will require a free account on PVOutput, and you will need to set up an API Key. You will also need to add your solar details which will give you a system Id.</p>

<h2 id="curtronics-aurora">Curtronics Aurora</h2>

<p>Grab this great little utility - <a href="http://www.curtronics.com/Solar/AuroraData.html">Curtronics Aurora</a>. Download, unzip, and install:</p>

<pre><code class="language-bash">wget http://www.curtronics.com/Solar/ftp/aurora-1.9.3.tar.gz
tar -xf aurora-1.9.3.tar.gz
cd aurora-1.9.3
make
sudo make install
</code></pre>

<p>At this point you should try a query and see if you can contact the inverter (keep in mind if it is dark outside the inverter is probably powered down).</p>

<p>Try the following command:</p>

<pre><code class="language-text">/usr/local/bin/aurora -a 2 /dev/ttyUSB0 -Y15 -e
</code></pre>

<p>If you are not having any luck, check if /dev/ttyUSB0 is correct (this is your usb-to-serial device). You should be able confirm it by reading through your start up messages with <code>dmesg</code>.</p>

<h2 id="solar-logger-sh">solar-logger.sh</h2>

<p>Save this script in your home folder as solar-logger.sh.</p>

<p>If you are using the default <code>pi</code> user, the path will be <code>/home/pi/solar-logger.sh</code></p>

<p>Make sure you set execute permission: <code>chmod 755 solar-logger.sh</code></p>

<pre><code class="language-bash">#!/bin/bash

# configuration
apikey=&quot;your api key here&quot;
system=&quot;your system Id here&quot;

rd=$(date +%Y%m%d)
rt1=$(date +%H)
rt2=$(date +%M)
rt=&quot;${rt1}%3A${rt2}&quot;
solarout=`/usr/local/bin/aurora -a 2 /dev/ttyUSB0 -Y15 -e -c | awk '{printf $1}'`
solarwatts=`echo ${solarout} | sed -e &quot;s/\.//&quot;`
url=&quot;https://pvoutput.org/service/r2/addstatus.jsp?d=${rd}&amp;t=${rt}&amp;v1=${solarwatts}&quot;

# only make the request if we have a value from the inverter
if [[ ! -z $solarwatts  ]]; then
    result=`curl -H &quot;X-Rate-Limit: 1&quot; -H &quot;X-Pvoutput-Apikey: ${apikey}&quot; -H &quot;X-Pvoutput-SystemId: ${system}&quot; ${url}`
    if [[ $result == *&quot;OK&quot;* ]]; then
        echo &quot;${rd} $(date +%H:%M) : API call successful, power output: ${solarout}&quot;
    else
        echo &quot;${rd} $(date +%H:%M) : API call failed, ${result}&quot;
    fi
else
    echo &quot;${rd} $(date +%H:%M) : Inverter communication failure&quot;
fi
</code></pre>

<h2 id="cron-job">Cron Job</h2>

<p>Edit your crontab (using <code>crontab -e</code>) and add the following record:</p>

<pre><code class="language-text">*/5 5-18 * * * /home/pi/solar-logger.sh &gt;&gt; /home/pi/solar-log.txt
</code></pre>

<p>This cron task will run the solar logger every 5 minutes between the hours of 5am and 6pm. You may want to adjust those times depending on your latitude.</p>

<p>This will give you a solar-log.txt file with entries like this:</p>

<pre><code class="language-text">20191201 18:25 : API call successful, power output: 20.373
20191201 18:30 : API call successful, power output: 20.373
</code></pre>

<p>Once you start seeing successful API calls you should be able to see your shiny new chart on PVOutput.</p>

<p><img class="pure-img blog-img " src="/images/solar-mon.jpg" alt="pvoutput live output chart" /></p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>If you are having issues, check the permissions on the <code>aurora</code> binary (755 should work).</p>

    <p>/eof</p>
</article>
    
    <article class="blog-post">
    <div class="post-header">
        <h2><a href="/tech/2014/05/19/ocr-solar-meter-reader-part1/">OCR Solar Meter Reader - Part 1</a></h2>
    </div>
    <div class="post-meta">

  
  

  
     
      
      
      
    
  
  <div class="article-meta">
      
      <div class="social-buttons"> 
            <a class="btn btn-social-icon btn-twitter" href="http://twitter.com/share?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2014%2f05%2f19%2focr-solar-meter-reader-part1%2f&amp;text=OCR%20Solar%20Meter%20Reader%20-%20Part%201&amp;via=dfrencham"><i class="fa fa-twitter"></i></a>
            <a class="btn btn-social-icon btn-facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdiydeveloper.io%2ftech%2f2014%2f05%2f19%2focr-solar-meter-reader-part1%2f&amp;t=OCR%20Solar%20Meter%20Reader%20-%20Part%201"><i class="fa fa-facebook"></i></a>
            <a class="btn btn-social-icon btn-linkedin" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2014%2f05%2f19%2focr-solar-meter-reader-part1%2f"><i class="fa fa-linkedin"></i></a>  
            <a class="btn btn-social-icon btn-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2014%2f05%2f19%2focr-solar-meter-reader-part1%2f&title=OCR%20Solar%20Meter%20Reader%20-%20Part%201"><i class="fa fa-reddit"></i></a>      
     </div>
     <div class="tags">
          <div class="taxonomy-tag">             
              <i class="fa fa-calendar fa-fw"></i>            
              <time>19 May 2014</time> 
          </div>
          
            
            
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/solar">solar</a>
                </div>
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/meter">meter</a>
                </div>
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/ocr">ocr</a>
                </div>
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/raspberry-pi">raspberry pi</a>
                </div>
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/tech-guide">tech-guide</a>
                </div>
              
            
          
      </div>
      
  </div>

</div>
    <p>I had some solar panels installed last year. I wanted to read my inverter statistics, but I also wanted to log exactly how much power I import/export. Challenge - I can&rsquo;t physically plug anything into the meter (power company regulations). What to do?</p>

<p>How about a web cam, raspberry pi, and OCR?</p>

<h2 id="the-goal">The Goal</h2>

<p>The goal is to get all my data to log auto-magically to the PVOutput portal (pictured). <a href="http://pvoutput.org/list.jsp?userid=20825">Here is my PVOutput page</a>.</p>

<p><a class="fancybox" rel="group" href="/images/solar-pvoutput.jpg" title="PVOutput Portal"><img class="pure-img img-thumbnail" src="/images/sm-solar-pvoutput.jpg" alt="Physical Layout" /></a></p>

<h2 id="the-problem">The Problem</h2>

<p>I have an array of PV panels on my roof, which are connected to an inverter. The inverter feeds generated power back into the power grid via my power meter (the power company pays me for this).</p>

<p>I decided I would use a Raspberry Pi to read data directly from the solar inverter. That gives me stats such as <em>the amount of power produced</em> by the array. It doesn&rsquo;t give me how much I actually export to the power grid - as that figure comes from the power meter.</p>

<p>The formula for exported power is:</p>

<div class="box-green pad10">Exported Power = Generated Power - Power Used by my house</div>

<p>So, how do I interface with my EM1000 power meter? The meter has a couple of ports:</p>

<ol>
<li>RS232 Serial Link</li>
<li>Optical Port</li>
</ol>

<p>Should be easy right?</p>

<p>Not quite.</p>

<p>The power company seal the RS232 port. Breaking those seals is a criminal offence. I did try to get permission to do it, but my provider (Energex) kept saying no. That leaves the Optical Port. Optical Readers are expensive, but a bigger problem is that Energex doesn&rsquo;t use a standard protocol. They came up with their own (figure that one out, existing protocols just aren&rsquo;t good enough read a number from a meter. I wonder how many hallucinogenic mushrooms were consumed to reach <em>that</em> decision).</p>

<p>So, what to do? The only other place data was visible was the LCD. Surely we can&rsquo;t just take photos and OCR (Optical Character Recognition) the result? It can&rsquo;t be that simple? Well&hellip;. kind of.</p>

<h3 id="physical-diagram">Physical Diagram</h3>

<p>Let&rsquo;s skip ahead to the physical diagram, and then look at how I got there. This is the physical set up of the system:</p>

<p><a class="fancybox" rel="group" href="/images/solar-physical.png" title="Physical layout"><img class="pure-img img-thumbnail" src="/images/solar-physical.png" alt="Physical Layout" /></a><br /></p>

<h2 id="physical-setup">Physical Setup</h2>

<p><a class="fancybox inline" rel="group" href="//images/solar03.jpg" title="Raspberry Pi"><img class="img-thumbnail inline textwrap-left" src="/images/sm_solar03.jpg" alt="Raspberry Pi" /></a>A power box is fairly small, so I expected a challenge fitting everything in.</p>

<p>Getting the Pi in there was fairly easy. A piece of velcro tape keeps it firmly in place.</p>

<p>The Pi&rsquo;s USB port does not provide enough juice to power anything more than a keyboard, so I have added a powered USB hub. That lets us power a light and a webcam.</p>

<p>For the webcam, I am using a Logitech C270. Due to the short distance between the cam and the display, I had trouble getting the camera to focus. For my first attempt, I mounted the camera above the power meter and used a mirror mounted on the door to get enough focus distance. This did work, but wasn&rsquo;t great, so I took apart the camera and manually refocused it. Here is a guide on how to refocus the camera: <a href="www.youtube.com/watch?v=vq71ihE7Ng8">YouTube: Refocus Logitech Webcam</a>. It is easy, but you can kiss your warranty goodbye.</p>

<p>With the focus fixed, I was able to mount the camera properly. I used some cheap metal strapping from Bunnings, which I bent into an &ldquo;L&rdquo; shape. This was screwed into the top of the meter box. To secure the camera, I removed the camera clip and then screwed the camera directly into my home made bracket.</p>

<h3 id="lighting">Lighting</h3>

<p>Lighting was a particular challenge. For the display to be readable via OCR, there needs to be a consistent brightness across the entire display. There also needs to be enough contrast to clearly differentiate the characters against the background.</p>

<p><img class="img-thumbnail inline textwrap-left" src="/images/solar-led-strip.jpg" alt="Fail Light" />I tried a flexible stick on strip light - but there were too many light sources, and they were too bright. I then tried an el-cheapo goose-neck USB light in a &ldquo;fake lightbulb&rdquo; housing - but that was too inconsistant. One side was dark, the other light!</p>

<p><a class="fancybox inline" rel="group" href="//images/solar01.jpg" title="Lighting up the box"><img class="img-thumbnail inline textwrap-right" src="/images/sm_solar01.jpg" alt="Lighting up the box" /></a>I settled on a USB goose-neck reading light (found by accident in Myer). I mounted it higher than the LED display to minimise reflections. I was nearly there, but not quite, I was <em>still</em> getting too much glare. My first eureka moment was spraying the inside of the power box lid with matt black paint. That cut down the glare, but I still had contrast issues. My second eureka moment was moving the camera down, so it looks up at the display on a 15 degree angle. Suddenly I had a razor sharp well lit image! nice!</p>

<h3 id="network">Network</h3>

<p>I tried WiFi first, but found that putting a wifi adaptor in a big metal box makes reception near impossible (not too surprising, I guess). I didn&rsquo;t want to run Cat6 cable to my power box (too much 240v power in the ceiling/wall cavities around there).</p>

<p>As luck would have it, I had some spare Netcomm Ethernet-Over-Power EoP adaptors sitting around. I plugged one in and away we went. If you haven&rsquo;t seen these before, they are really neat. They use your existing electrical wiring and give speeds anywhere up to 500Mbit (half duplex!). Like everything, they have a catch. If your electrical wiring is bad, or you try to run them across circuits - performance will be abysmal. Certain appliances can also interfere with them. Have you ever tried troubleshooting a network where turning on a kettle (jug) kills connectivity?</p>

<h2 id="part-2">Part 2</h2>

<p>The next part details the software side of the project.</p>
    <p>/eof</p>
</article>
    
    <article class="blog-post">
    <div class="post-header">
        <h2><a href="/tech/2014/05/19/ocr-solar-meter-reader-part2/">OCR Solar Meter Reader - Part 2</a></h2>
    </div>
    <div class="post-meta">

  
  

  
     
      
      
      
    
  
  <div class="article-meta">
      
      <div class="social-buttons"> 
            <a class="btn btn-social-icon btn-twitter" href="http://twitter.com/share?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2014%2f05%2f19%2focr-solar-meter-reader-part2%2f&amp;text=OCR%20Solar%20Meter%20Reader%20-%20Part%202&amp;via=dfrencham"><i class="fa fa-twitter"></i></a>
            <a class="btn btn-social-icon btn-facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdiydeveloper.io%2ftech%2f2014%2f05%2f19%2focr-solar-meter-reader-part2%2f&amp;t=OCR%20Solar%20Meter%20Reader%20-%20Part%202"><i class="fa fa-facebook"></i></a>
            <a class="btn btn-social-icon btn-linkedin" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2014%2f05%2f19%2focr-solar-meter-reader-part2%2f"><i class="fa fa-linkedin"></i></a>  
            <a class="btn btn-social-icon btn-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2014%2f05%2f19%2focr-solar-meter-reader-part2%2f&title=OCR%20Solar%20Meter%20Reader%20-%20Part%202"><i class="fa fa-reddit"></i></a>      
     </div>
     <div class="tags">
          <div class="taxonomy-tag">             
              <i class="fa fa-calendar fa-fw"></i>            
              <time>19 May 2014</time> 
          </div>
          
            
            
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/solar">solar</a>
                </div>
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/meter">meter</a>
                </div>
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/ocr">ocr</a>
                </div>
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/raspberry-pi">raspberry pi</a>
                </div>
              
                <div class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/tech-guide">tech-guide</a>
                </div>
              
            
          
      </div>
      
  </div>

</div>
    <p>Continuation of Raspberry Pi Solar Data Logger article. In this part I detail the software side of the OCR solar data logger. Perl, APIs, C. Hooray!</p>

<h2 id="the-software-part">The Software Part</h2>

<p>With the hardware part sorted, now comes the easy part - software.</p>

<p>Getting inverter data is easy enough, but reading the meter is more of a challenge.</p>

<p>There are 3 basic parts to this:</p>

<ol>
<li>Take photos</li>
<li>OCR the photos and store the values</li>
<li>Send it to the PVOutput.com API</li>
</ol>

<p>We also need something to tie it all together. I&rsquo;d usually use my beloved DotNet stack, but this is Linux so that means Mono&hellip; and getting Mono working on a Raspberry Pi requires some form of animal sacrifice&hellip; or a prayer to Zeus&hellip; or something.</p>

<p>I considered using shell script, but then I remembered how much I hate shell scripting. I fired up my editor and hacked up some Perl. Why Perl? Perl is tried and tested, has good library support, and is available pretty much everywhere. Also, this is valid perl code which amuses me far more than it should:</p>

<pre class="language-perl"><code class="language-perl">
    print'````'^RPQT
</code></pre>

<p>How can you not love a language where that is valid code? <a href="http://www.perlmonks.org/?node=Obfuscated%20Code">source</a>. The only language sillier than that is BrainF*ck&hellip; god help anyone trying to do something productive with that.</p>

<h3 id="process-overview">Process Overview</h3>

<p>Here is an flow chart of the process.</p>

<p><a class="fancybox" rel="group" href="/images/solar-process.png" title="Physical layout"><img class="pure-img img-thumbnail" src="/images/solar-process.png" alt="Physical Layout" /></a><br /></p>

<p>Essentially, the pseudo-code version goes like this:</p>

<pre><code style="color:white;">At 11:45pm take 20 photos
For each photo
    OCR photo
    If (value -ve) store export
    Else store import
If we don't have import/export explode, and notify admin
Store import/export in CSV
Calculate daily import/export by subtracting previous days values
Send daily import/export to PVI Output REST API
</code></pre>

<h2 id="taking-photos">Taking Photos</h2>

<p>I found a handy little command line tool for taking snaps - <a href="http://manpages.ubuntu.com/manpages/natty/man1/uvccapture.1.html">uvccapture</a>. All it needs is a camera location and resolution and away it goes.</p>

<p>This is a photo taken with uvccapture:</p>

<p><img class="pure-img img-thumbnail" src="/images/solar-webcam.jpg" alt="Web cam photo" /></p>

<h2 id="ocr-time">OCR time!</h2>

<p>Figuring out how to OCR the display proved a bit tougher than I&rsquo;d hoped. I found this great little app -<a href="http://www.unix-ag.uni-kl.de/~auerswal/ssocr/">Seven Segment Optical Character Recognition</a>, SSOCR for short.</p>

<p>SSOCR was developed with the intent of reading RSA security tokens, allowing one token to be easily shared by a group of people - which completely circumvents the point of having a RSA token.</p>

<p>The gentleman who wrote it is a stern German who appears to still live in 2005, in a world devoid of joy, happiness, and code sharing tools such as GitHub. He&rsquo;s aware of GitHub, but refuses to use it. I&rsquo;m sure he&rsquo;s a very nice guy, but he needs to be slapped into 2014.</p>

<p>Moving along.</p>

<p>SSOCR is written in C, and has the source code available - allowing us to modify it to work with something other than an ancient RSA token.</p>

<p>The changes I had to make are:</p>

<ul>
<li>option to ignore decimal points</li>
<li>option to allow minus signs (for negative numbers). Only the first character is checked.</li>
<li>option to allow blank characters</li>
<li>recognise a 9 with the lower segment not set</li>
</ul>

<p>I emailed the stern German with a list of the changes I made, but neglected to email my patch through (I did intend to!). In efficient German fashion he has implemented all of those things on his own (they are all in the latest version of SSOCR).</p>

<p>SSOCR is really cool. It scans the image, line by line, and attempts to identify line segments. It then uses the segment data to figure out which number was discovered.</p>

<p>Here is some debug output from SSOCR:</p>

<p><img class="pure-img img-thumbnail" src="/images/solar-output.png" alt="OCR Output" /></p>

<p>The different coloured lines show where SSOCR has identified line segments. Neat.</p>

<p>Once I have the SSOCR output, my perl script store it in a CSV file.</p>

<h2 id="hello-pvoutput-api">Hello, PVOutput API</h2>

<p>PVOutput provide a handy REST API for pushing your data in. As much as REST is straightforward enough, why can&rsquo;t the damn thing provide a WSDL like SOAP? instead, I have to type out all my requests like some sort of neandrathal. On the plus side, I don&rsquo;t have to deal with 3 miles of XML gibberish, so there&rsquo;s that.</p>

<p>This is how easy it is to submit data:</p>

<pre class="language-perl"><code class="language-perl">
    my $ua = LWP::UserAgent->new;
    $ua->default_header(
                    "X-Pvoutput-Apikey" => $pvoutput_apikey,
                    "X-Pvoutput-SystemId" => $pvoutput_sysid,
                    "Content-Type" => "application/x-www-form-urlencoded");

    my $pvoutput_url = "http://pvoutput.org/service/r2/addoutput.jsp";
    my $request = POST $pvoutput_url, [ d => $date, e => $export*1000), ip => ($import*1000) ];

    my $res = $ua->request($request);

    if (! $res->is_success) {
        die "Couldn't submit data to pvoutput.org:" . $res->status_line . "\n";
    }
</code></pre>

<p>There is another reason to love perl. If things go wrong, we don&rsquo;t exit, or error like lesser languages. No, we commit seppiku. &ldquo;I can&rsquo;t fulfil this task you ask of me, so I&rsquo;m going to die&rdquo;.</p>

<p>Perl is great.</p>

<h2 id="getting-inverter-data">Getting Inverter Data</h2>

<p>I use <a href="http://www.curtronics.com/Solar/AuroraData.html">Curtronics Aurora</a> program to retrieve statistics from the inverter, once per minute. These statistics are logged and stored in daily CSV files.</p>

<p>Data is sent to <a href="http://pvoutput.org">PVOutput</a> every two minutes, using the <a href="https://bitbucket.org/pvoutput/pvoutput-integration-service">pvoutput-integration-service</a>.</p>

<p>Once running, this service is set and forget. Just remember to add a start up script for it, so it comes back up if the Pi goes down for any reason.</p>

<p>So, between the pvoutput integration service - and my OCR magic above, both the inverter data and meter data are being sent to the pvoutput portal. Hooray!</p>

<h2 id="when-it-all-goes-wrong">When it all goes wrong</h2>

<p>Did you know the Raspberry Pi has a hardware Watchdog Timer? Overview:</p>

<blockquote>
<p>A watchdog timer is a special kind of timer commonly found on embedded systems that is used to detect when the running software is hung up on some task. The watchdog timer is basically a countdown timer that counts from some initial value down to zero. When zero is reached, the watchdog timer understands that the system is hung up and resets it.</p>
</blockquote>

<p>The quote above is from <a href="http://blog.ricardoarturocabral.com/2013/01/auto-reboot-hung-raspberry-pi-using-on.html">Ricardo&rsquo;s Workbench</a>. He explains how to run it on your Pi. So, now my Pi reboots itself if it hangs.</p>

<p>Very nice.</p>

<h2 id="conclusion">Conclusion</h2>

<p>It has taken a long time, and lots of experimenting to get the solar meter reader working reliably. I&rsquo;ve had a lot of fun doing it, and learned a few things.</p>

<p>I went up the garden path a few times. For example: when I was having trouble getting the OCR to work reliably, I wrote a Node.js based site for selecting photos from the meter and updating pvoutput. That&rsquo;s a future blog post.</p>

<p>I&rsquo;m really blown away by how far things have come in the last few years. x86 PCs the size of a mouse? Incredible. I can&rsquo;t wait to see what the next few years bring.</p>
    <p>/eof</p>
</article>
    
  </div>
</div>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48772536-1', 'auto');
  ga('send', 'pageview');

</script>



<footer class="page-footer">
    <div class="pure-menu">
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-2">
            
              <a class="icon-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
            
              <a class="icon-link" href="/archive/"><i class='fa fa-list fa-fw'></i>Archive</a>
            
              <a class="icon-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
            
            <a class="icon-link" href="https://github.com/dfrencham" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    
        </div>
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-2">
            <div>
  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>
      Built with <a href="https://gohugo.io/" target="_blank">Hugo</a>
    </small>
  </div>
</div>

        </div>
    </div>
</footer>
</body>
</html>
