<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.40.2" />

  <title>Nested Dependencies in MVC4 &middot; DIYDeveloper.io</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blog.css">
  <link rel="stylesheet" href="/css/bootstrap-social.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700" rel="stylesheet" type="text/css">

  
  

  

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

  
  

  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700,700i,900,900i|Fira+Sans:400,400i,700,700i,900,900i|Quicksand:300,400,500,700" rel="stylesheet" />
  <link href="/css/prism.css" rel="stylesheet" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src='/js/prism.js' type='text/javascript'></script>
  <script src='//cdnjs.cloudflare.com/ajax/libs/stackblur-canvas/1.4.0/stackblur.min.js' type='text/javascript'></script>


  
  <link rel="stylesheet" href="/css/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
  <script type="text/javascript" src="/js/jquery.fancybox.pack.js?v=2.1.5"></script>

  <script type='text/javascript'>
   $(document).ready(function() {
      $(".fancybox").fancybox({
      helpers : {
          title: {
              type: 'inside',
              position: 'top'
          }
      },
      nextEffect: 'fade',
      prevEffect: 'fade'});
   });
  </script>

</head>


<body>
<div id="layout">

  
<article id="main">

<div class="header title-header">
    <h1><a href="/">DIY Developer</a></h1>
    <h2>Power tools, software, 3d printing</h2>
</div>

<div class="content">

    <div class="page-header">
        <h1>Nested Dependencies in MVC4</h1>
    </div>
  
  <div class="post-meta">

  
  

  
     
      
      
      
    
  
  <div>
      
      <div style="float: left">
        <p>
            <time>18 Jul 2013</time>
            
            <br />
            <a class="btn btn-social-icon btn-twitter" href="http://twitter.com/share?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2013%2f07%2f18%2fnested-dependencies-in-mvc4%2f&amp;text=Nested%20Dependencies%20in%20MVC4&amp;via=dfrencham"><i class="fa fa-twitter"></i></a>
            <a class="btn btn-social-icon btn-facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdiydeveloper.io%2ftech%2f2013%2f07%2f18%2fnested-dependencies-in-mvc4%2f&amp;t=Nested%20Dependencies%20in%20MVC4"><i class="fa fa-facebook"></i></a>
            <a class="btn btn-social-icon btn-google-plus" href="https://plus.google.com/share?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2013%2f07%2f18%2fnested-dependencies-in-mvc4%2f"><i class="fa fa-google-plus"></i></a>
            <a class="btn btn-social-icon btn-linkedin" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2013%2f07%2f18%2fnested-dependencies-in-mvc4%2f"><i class="fa fa-linkedin"></i></a>      
            
        </p>
     </div>      
      <div style="float: right">
          
          <p>
          
          
          
            <span class="taxonomy-tag">             
                <i class="fa fa-tags fa-fw"></i>            
                <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/MVC4">MVC4</a>
            </span>
          
            <span class="taxonomy-tag">             
                <i class="fa fa-tags fa-fw"></i>            
                <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/development">development</a>
            </span>
          
            <span class="taxonomy-tag">             
                <i class="fa fa-tags fa-fw"></i>            
                <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/C">C#</a>
            </span>
          
            <span class="taxonomy-tag">             
                <i class="fa fa-tags fa-fw"></i>            
                <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/dotnet">dotnet</a>
            </span>
          
          
          </p>
          
      </div>
      <div style="clear:both;"></div>
  </div>

</div>

  <p>Given how complex the average MVC4 application can become, it is likely that you are going to come across the situation where you build up a dependency chain. It may look like this: Controller -&gt; Provider/Manager -&gt; Dependency<br /></p>

<p>&nbsp;A common scenario may be that your controller needs a Lookup Manager, and that manager needs a cached query passed in.</p>

<p>In this scenario, the Unity.Mvc4 nuGet package comes into play.
</p>

<p>Here is our home controller:</p>

<pre class="line-numbers"><code class="language-csharp">
// Home controller
public class HomeController : AsyncController
{
    private ILookupManager&lt;StatusLookup&gt; statusLookup;

    // constructor with lookup dependency
    public HomeController(ILookupManager&lt;StatusLookup&gt; statusLookup)
    {
        this.statusLookup = statusLookup;
    }
}
</code></pre>

<p>Notice that the constructor requires the StatusLookup.</p>

<p>Here is the Status Manager implementation. Observe that it is a generic class, expecting a StatusLookup object. The constructor requires a query passed in (of type IQuery).</p>

<pre class="line-numbers"><code class="language-csharp">
//LookupManager.cs
public class LookupManager&lt;T&gt; : ILookupManager&lt;T&gt; where T : ILookupField
{
    private IQuery&lt;T&gt; _query;

    // lookup manager has a Query dependency
    public LookupManager(IQuery&lt;T&gt; query)
    {
        _query = query;
    }

    public List&lt;T&gt; Lookup()
    {
        // return lookup query result
        return _query.Get();
    }
}
</code></pre>

<p>This is where life gets easy. After installing the Unity.Mvc4 nuGet package, our MVC project gains a &ldquo;boostrapper&rdquo; class.&nbsp;This provides us with a simple mechanism to get any dependency into any class in our MVC app. It works by utilising the Unity&nbsp;Dependency Injection container.</p>

<pre class="line-numbers"><code class="language-csharp">
// Boostrapper.cs
// Added by the Unity.Mvc4 NuGet package
private static IUnityContainer BuildUnityContainer()
{
    var container = new UnityContainer();

    // initialise Status lookup
    container.RegisterType&lt;IQuery&lt;StatusLookup&gt;, QueryStatusLookup&gt;();

    // make Status lookup available to mvc4 controllers
    container.RegisterType&lt;ILookupManager&lt;StatusLookup&gt;, LookupManager&lt;StatusLookup&gt;&gt;();

    RegisterTypes(container);
    return container;
}
</code></pre>

<p>If we have a look at the BuildUnityContainer() method, there are two calls to container.RegisterType(). The first is to provide the IQuery dependency to StatusLookup. The second is to provide the StatusLookup dependency to our HomeController.</p>

<p>To keep it all manageable, make sure your dependencies are passed using an interface (ILookupManager, and IQuery in my case).</p>

  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://diydeveloper.io/tech/2013/10/13/vs2013-web-essentials---zen-coding-is-a-huge-time-saver-for-web-developers/">VS2013 Web Essentials   Zen Coding is a huge time saver for web developers</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://diydeveloper.io/tech/2013/10/13/vs2013-web-essentials---zen-coding-is-a-huge-time-saver-for-web-developers/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'dannydotnet';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</article>
</div>
<script src="/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48772536-1', 'auto');
  ga('send', 'pageview');

</script>



<footer class="page-footer">
    <div class="pure-menu">
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-2">
            
              <a class="icon-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
            
              <a class="icon-link" href="/posts/"><i class='fa fa-list fa-fw'></i>Archive</a>
            
              <a class="icon-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
            
            <a class="icon-link" href=""><i class="fa fa-rss fa-fw"></i>RSS</a>
            <a class="icon-link" href="https://github.com/dfrencham" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    
        </div>
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-2">
            <div>
  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>
      Built with <a href="https://gohugo.io/" target="_blank">Hugo</a>
      Hosted on <a href="https://firebase.google.com/" target="_blank">Firebase</a>
    </small>
  </div>
</div>

        </div>
    </div>
</footer>
</body>
</html>

