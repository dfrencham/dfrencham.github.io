<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.58.2" />

  <title>DIYDeveloper.io</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.1/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.1/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.1/grids-responsive-min.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/bootstrap-social.css">
  <link rel="stylesheet" href="/css/blog.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Vollkorn" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700" rel="stylesheet" type="text/css">

  
  
  <link rel="alternate" type="application/rss+xml" title="DIYDeveloper.io" href="https://diydeveloper.io/index.xml" />
  

  

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

  
  

  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700,700i,900,900i|Fira+Sans:400,400i,700,700i,900,900i|Quicksand:300,400,500,700" rel="stylesheet" />
  <link href="/css/prism.css" rel="stylesheet" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src='/js/prism.js' type='text/javascript'></script>
  <script src='//cdnjs.cloudflare.com/ajax/libs/stackblur-canvas/1.4.0/stackblur.min.js' type='text/javascript'></script>


  
  <link rel="stylesheet" href="/css/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
  <script type="text/javascript" src="/js/jquery.fancybox.pack.js?v=2.1.5"></script>

  <script type='text/javascript'>
   $(document).ready(function() {
      $(".fancybox").fancybox({
      helpers : {
          title: {
              type: 'inside',
              position: 'top'
          }
      },
      nextEffect: 'fade',
      prevEffect: 'fade'});
   });
  </script>

</head>


<body>
<div id="layout" class="pure-g">

  
<div id="main" class="pure-u-sm-1">
<header>
    <div class="header title-header">
        <h1><a href="/">DIY Developer</a></h1>
        <h2>Power tools, software, 3d printing</h2>
    </div>
</header>

<section class="content">
  <div class="pure-g">
    <div class="pure-u-md-3-4 pure-u-sm-1 left-col">
    
      <div class="pure-g post-index">
        
        <div class="pure-u-1">
    <article class="blog-post">
        <div class="post-header">
            <h2><a href="/post/2019-09-18-make-great-git-diagrams/">Make great git diagrams</a></h2>
        </div>
        <div class="post-meta">

  
  

  
     
      
      
      
    
  
  <div class="article-meta">
      
      <div class="">
        <p>           
            <a class="btn btn-social-icon btn-twitter" href="http://twitter.com/share?url=https%3a%2f%2fdiydeveloper.io%2fpost%2f2019-09-18-make-great-git-diagrams%2f&amp;text=Make%20great%20git%20diagrams&amp;via=dfrencham"><i class="fa fa-twitter"></i></a>
            <a class="btn btn-social-icon btn-facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdiydeveloper.io%2fpost%2f2019-09-18-make-great-git-diagrams%2f&amp;t=Make%20great%20git%20diagrams"><i class="fa fa-facebook"></i></a>
            <a class="btn btn-social-icon btn-linkedin" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdiydeveloper.io%2fpost%2f2019-09-18-make-great-git-diagrams%2f"><i class="fa fa-linkedin"></i></a>  
            <a class="btn btn-social-icon btn-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdiydeveloper.io%2fpost%2f2019-09-18-make-great-git-diagrams%2f&title=Make%20great%20git%20diagrams"><i class="fa fa-reddit"></i></a>      
          </p>
     </div>
     <div class="">
          <p>
          <span class="taxonomy-tag">             
              <i class="fa fa-calendar fa-fw"></i>            
              <time>18 Sep 2019</time> 
          </span>
          
            
            
              
                <span class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/git">git</a>
                </span>
              
                <span class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/diagram">diagram</a>
                </span>
              
                <span class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/programming">programming</a>
                </span>
              
            
          
          </p>
      </div>
      
  </div>

</div>
        <p>If you&rsquo;re a developer, sooner or later you find yourself having to talk about git branching strategies. Drawing this up in a drawing tool can be very time consuming for most of us mere mortals. Luckily there is a great little javascript library that exists purely for making git branching diagrams.</p>

<p>See the nice diagram below? it is being created in real time by <a href="https://github.com/nicoespeon/gitgraph.js">gitgraph.js</a>.</p>

<script src="https://cdn.jsdelivr.net/npm/@gitgraph/js" crossorigin="anonymous"></script>
<div id="graph-container" class="add-scroll"></div>

<script>

const graphContainer = document.getElementById("graph-container");

const gitTemplate = GitgraphJS.templateExtend(GitgraphJS.TemplateName.Metro, {
  colors:  ["#979797", "#008fb5", "#009900"],
  commit: {
    message: {
      displayAuthor: false,
      font: "12pt sans-serif",
      displayHash: false
    },
  },
  branch: {
    lineWidth: 8,
    label: {
      font: "12pt sans-serif"
    }
  }
});

// Instantiate the graph.
const gitgraph = GitgraphJS.createGitgraph(graphContainer, {
  template: gitTemplate,
  orientation: "vertical"
});

var master = gitgraph.branch("master");
master.commit("Initial commit");

var develop = gitgraph.branch("develop");
develop.commit("new dev stream").commit("bug fix");

var feature = develop.branch("feature");
feature.commit("Display blog posts in 3d");
feature.commit("Add OpenGL option");
develop.merge(feature, "Pull Request: feature TO develop");

develop.tag("RC1");
master.merge(develop, "Pull Request: develop TO master");


// var m = gitgraph.branch("master");
// var prod = m.branch("production");

// prod.commit("prod commit");

// var iref = prod.branch("1909-q3-iref");
// iref.commit("iref bug fix");
// iref.commit("iref bug fix");

// var mergeb = iref.branch("merges/1909-q3-iref/production-20190916");
// mergeb.commit("");
// mergeb.merge(prod, "merge from production");
// iref.merge(mergeb, "Pull Request back to IREF");

// iref.commit("bug fix");

// prod.commit("prod commit");



</script>

<p>Setting things up is pretty straight forward. You can install with <code>npm i --save @gitgraph/js</code>, or simply import the CDN version:</p>

<p><code>&lt;script src=&quot;https://cdn.jsdelivr.net/npm/@gitgraph/js&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</code></p>

<p>Add a div to the page, then pass that DOM node into <code>createGitgraph</code>. You can roll with the defaults, or pass in customisations via <code>createGitgraph()</code>.</p>

<p>Once you graph is created, you draw the diagram in the same way you would work with git branches.</p>

<ul>
<li>Use <strong>.branch()</strong> against an existing branch to create a new branch</li>
<li>Use <strong>.commit()</strong> against a branch to create a commit</li>
<li>Use <strong>.tag()</strong> to tag a branch</li>
<li>Use <strong>destinationBranch.merge(yourBranch)</strong> to merge</li>
</ul>

<h2 id="creating-a-custom-template">Creating a Custom Template</h2>

<p>To create a custom template, call <code>GitgraphJS.templateExtend(templateName, options)</code> where template name is one of the 2 defaults:</p>

<ul>
<li>GitgraphJS.TemplateName.Metro</li>
<li>GitgraphJS.TemplateName.BlackArrow</li>
</ul>

<p>The options object provides all the overrides. To see which objects you can override, take a look in the <a href="https://github.com/nicoespeon/gitgraph.js/blob/master/packages/gitgraph-core/src/template.ts">Gitgraph repo</a>;</p>

<p>Pass the new template object into the create call: <code>createGitgraph(container, { template: yourTemplate })</code></p>

<p>Check out the code sample for more detail.</p>

<h2 id="browser-support">Browser Support</h2>

<p>This library supports modern browsers - IE and Edge do not work. Edge will start working once Edge-Chromoium is out in the wild, but for now stick with Chrome or Firefox.</p>

<h2 id="code-sample">Code Sample</h2>

<pre><code class="language-javascript">
const graphContainer = document.getElementById("graph-container");

const gitTemplate = GitgraphJS.templateExtend(GitgraphJS.TemplateName.Metro, {
  commit: {
    message: {
      displayAuthor: false,
      font: "12pt sans-serif"
    },
  },
  branch: {
    lineWidth: 8,
    label: {
      font: "12pt sans-serif"
    }
  }
});

// Instantiate the graph.
const gitgraph = GitgraphJS.createGitgraph(graphContainer, {
  template: gitTemplate
});

var master = gitgraph.branch("master");
master.commit("Initial commit");

var develop = gitgraph.branch("develop");
develop.commit("new dev stream").commit("bug fix");

var feature = develop.branch("feature");
feature.commit("Display blog posts in 3d");
feature.commit("Add OpenGL option");
develop.merge(feature, "Pull Request: feature TO develop");

develop.tag("RC1");
master.merge(develop, "Pull Request: develop TO master");
</code></pre>
        /eof
    </article>
</div>
        
        <div class="pure-u-1">
    <article class="blog-post">
        <div class="post-header">
            <h2><a href="/tech/2018/06/07/12v-fan-on-24v-printer/">Put a 12v fan on a 24v 3d printer</a></h2>
        </div>
        <div class="post-meta">

  
  

  
     
      
      
      
    
  
  <div class="article-meta">
      
      <div class="">
        <p>           
            <a class="btn btn-social-icon btn-twitter" href="http://twitter.com/share?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2018%2f06%2f07%2f12v-fan-on-24v-printer%2f&amp;text=Put%20a%2012v%20fan%20on%20a%2024v%203d%20printer&amp;via=dfrencham"><i class="fa fa-twitter"></i></a>
            <a class="btn btn-social-icon btn-facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdiydeveloper.io%2ftech%2f2018%2f06%2f07%2f12v-fan-on-24v-printer%2f&amp;t=Put%20a%2012v%20fan%20on%20a%2024v%203d%20printer"><i class="fa fa-facebook"></i></a>
            <a class="btn btn-social-icon btn-linkedin" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2018%2f06%2f07%2f12v-fan-on-24v-printer%2f"><i class="fa fa-linkedin"></i></a>  
            <a class="btn btn-social-icon btn-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2018%2f06%2f07%2f12v-fan-on-24v-printer%2f&title=Put%20a%2012v%20fan%20on%20a%2024v%203d%20printer"><i class="fa fa-reddit"></i></a>      
          </p>
     </div>
     <div class="">
          <p>
          <span class="taxonomy-tag">             
              <i class="fa fa-calendar fa-fw"></i>            
              <time>07 Jun 2018</time> 
          </span>
          
            
            
              
                <span class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/3dprinter">3dprinter</a>
                </span>
              
                <span class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/electronics">electronics</a>
                </span>
              
            
          
          </p>
      </div>
      
  </div>

</div>
        <p>More and more 3d printers are coming with 24 volt fans&hellip; which can be a problem
because 24v fans can be hard to find. Here is how you can attach a 12 volt Noctua fan.</p>

<p>If you want a great, quiet hot-end fan&hellip; look no further than the <a target="_blank" href="https://www.amazon.com/gp/product/B009NQLT0M/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B009NQLT0M&linkCode=as2&tag=dide00-20&linkId=1d6e2ba2aa4b6fdb8ae5a887fe5121fd">Noctua (NF-A4x10 FLX)</a><img src="//ir-na.amazon-adsystem.com/e/ir?t=dide00-20&l=am2&o=1&a=B009NQLT0M" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />. It is 12volt, practically silent, and comes with some handy adaptors.</p>

<p>The OmniJoin adaptor is the black connector in the first photo with 2 wires attached. You&rsquo;ll also need:</p>

<ul>
<li>a cheap buck converter</li>
<li>a 2 pin JST plug (for the printer end)</li>
<li>soldering iron</li>
<li>multi meter</li>
</ul>

<p><img class="pure-img blog-img " src="/images/i3plusfan1.jpg" alt="parts" />
<em>Parts needed</em></p>

<h2 id="steps">Steps</h2>

<ol>
<li>Solder the positive and negative wires from the JST connector to the input terminals of your buck converter.</li>
<li>Ensure the printer is off, connect your multi-meter to the output terminals of the buck converter (set the multimeter for DC voltage)</li>
<li>Plug in the jst cable to your hot end fan header</li>
<li>Power up the printer, and check the voltage on the multimeter. Use a small flathead screw driver to adjust the buck converter voltage down to 12volts</li>
<li>Power down the printer, disconnect the buck converter and solder the OmniJoin adaptor to the output terminals of the buck converter</li>
<li>Mount the buck converter near your hot end. Note that you will need to insulate the back of it if you are fixing it on a metal surface. Electrical tape is fine for this.</li>
</ol>

<p>You are now able to run 12 volt fans on your printer.</p>

<h2 id="gallery">Gallery</h2>

<p><img class="pure-img blog-img " src="/images/i3plusfan2.jpg" alt="adjusting the voltage" />
<em>Adjusting the voltage</em></p>

<p><img class="pure-img blog-img " src="/images/i3plusfan3.jpg" alt="mounted buck converter" />
<em>Buck converter in place</em></p>
        /eof
    </article>
</div>
        
        <div class="pure-u-1">
    <article class="blog-post">
        <div class="post-header">
            <h2><a href="/diy/2016/01/18/a-trip-to-the-wreckers/">How to find spare parts at the wreckers</a></h2>
        </div>
        <div class="post-meta">

  
  

  
    
      
      
      
    
  
  <div class="article-meta">
      
      <div class="">
        <p>           
            <a class="btn btn-social-icon btn-twitter" href="http://twitter.com/share?url=https%3a%2f%2fdiydeveloper.io%2fdiy%2f2016%2f01%2f18%2fa-trip-to-the-wreckers%2f&amp;text=How%20to%20find%20spare%20parts%20at%20the%20wreckers&amp;via=dfrencham"><i class="fa fa-twitter"></i></a>
            <a class="btn btn-social-icon btn-facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdiydeveloper.io%2fdiy%2f2016%2f01%2f18%2fa-trip-to-the-wreckers%2f&amp;t=How%20to%20find%20spare%20parts%20at%20the%20wreckers"><i class="fa fa-facebook"></i></a>
            <a class="btn btn-social-icon btn-linkedin" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdiydeveloper.io%2fdiy%2f2016%2f01%2f18%2fa-trip-to-the-wreckers%2f"><i class="fa fa-linkedin"></i></a>  
            <a class="btn btn-social-icon btn-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdiydeveloper.io%2fdiy%2f2016%2f01%2f18%2fa-trip-to-the-wreckers%2f&title=How%20to%20find%20spare%20parts%20at%20the%20wreckers"><i class="fa fa-reddit"></i></a>      
          </p>
     </div>
     <div class="">
          <p>
          <span class="taxonomy-tag">             
              <i class="fa fa-calendar fa-fw"></i>            
              <time>18 Jan 2016</time> 
          </span>
          
            
            
              
                <span class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/tools">tools</a>
                </span>
              
            
          
          </p>
      </div>
      
  </div>

</div>
        <p>Wrecking yards (or junk yards if you are American) are a great place to get spare parts for your car at massive discounts. There are a few things you need to know before going.</p>

<h2 id="you-re-not-in-a-department-store">You&rsquo;re not in a department store</h2>

<p>You are not going to find organised shelves of car parts. What you are going to find is row after row of partially dismantled cars, which may be stacked in precarious ways.</p>

<p><img class="pure-img blog-img centered" src="/images/diy/wreckers2.jpg" alt="rows of cars" /></p>

<h3 id="1-ring-before-you-go">1. Ring before you go</h3>

<p>A wrecking yard is a big place, and cars have a lot of parts. Some wreckers keep an inventory of parts available. Others will send someone to run around the yard looking for the car part you need. Ring first, or you are going to be wasting a drive.</p>

<h3 id="2-bring-tools">2. Bring tools</h3>

<p>Great, they have a tow bar! Just what you need. The catch is that it is still bolted to the car. Some wreckers will lend tools, some won&rsquo;t. Bring your own tools. At a minimum, bring:</p>

<ul>
<li>a socket set</li>
<li>a shifter spanner (monkey wrench)</li>
<li>screw drivers (Phillips and Flat head)</li>
</ul>

<p>If you have a breaker bar, put that in your boot/trunk too (it will help if you need to remove rusted on bolts).</p>

<h3 id="3-bring-a-camera-phone">3. Bring a camera / phone</h3>

<p>Take photos of the part you are removing. It helps when you fit it to your car.</p>

<h3 id="4-bring-a-snap-lock-bag-to-put-nuts-screws-bolts-in">4. Bring a snap lock bag to put nuts / screws / bolts in</h3>

<p>You&rsquo;re probably going to have a few once you remove the part.</p>

<h3 id="5-be-sun-safe">5. Be sun safe</h3>

<p>Here in Brisbane, the sun can burn you in under 20 minutes. You are probably going to be stuck in the sun while you work. Hat, sunglasses, and sunscreen are a must.</p>

<h3 id="6-prices-are-negotiable">6. Prices are negotiable</h3>

<p>The wrecker doesn&rsquo;t want parts sitting on their lot. If something has been there a while, they are going to be keen to offload it. Make an offer. The worst they can say is no.</p>

<h3 id="7-a-wrecking-yard-is-dangerous">7. A wrecking yard is dangerous</h3>

<p>There are hazards all over the place. Sharp metal littered around, heavy machinery in use, cars balanced at odd angles. If you&rsquo;re unlucky, you might find venomous snakes sunning themselves in-between rows of cars. Keep your wits about you, don&rsquo;t wear headphones, and don&rsquo;t bring your kids (most wrecking yards won&rsquo;t even let them in).</p>

<p><img class="pure-img blog-img centered" src="/images/diy/wreckers1.jpg" alt="dont fall on me" /></p>

<p>And that folks, is how you survive your trip to a wrecking yard. Now I&rsquo;m off to fit a tow bar.</p>
        /eof
    </article>
</div>
        
        <div class="pure-u-1">
    <article class="blog-post">
        <div class="post-header">
            <h2><a href="/tech/2015/11/27/swift-pcap/">Calling pcap from Swift (using a closure)</a></h2>
        </div>
        <div class="post-meta">

  
  

  
     
      
      
      
    
  
  <div class="article-meta">
      
      <div class="">
        <p>           
            <a class="btn btn-social-icon btn-twitter" href="http://twitter.com/share?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2015%2f11%2f27%2fswift-pcap%2f&amp;text=Calling%20pcap%20from%20Swift%20%28using%20a%20closure%29&amp;via=dfrencham"><i class="fa fa-twitter"></i></a>
            <a class="btn btn-social-icon btn-facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdiydeveloper.io%2ftech%2f2015%2f11%2f27%2fswift-pcap%2f&amp;t=Calling%20pcap%20from%20Swift%20%28using%20a%20closure%29"><i class="fa fa-facebook"></i></a>
            <a class="btn btn-social-icon btn-linkedin" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2015%2f11%2f27%2fswift-pcap%2f"><i class="fa fa-linkedin"></i></a>  
            <a class="btn btn-social-icon btn-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdiydeveloper.io%2ftech%2f2015%2f11%2f27%2fswift-pcap%2f&title=Calling%20pcap%20from%20Swift%20%28using%20a%20closure%29"><i class="fa fa-reddit"></i></a>      
          </p>
     </div>
     <div class="">
          <p>
          <span class="taxonomy-tag">             
              <i class="fa fa-calendar fa-fw"></i>            
              <time>27 Nov 2015</time> 
          </span>
          
            
            
              
                <span class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/swift">swift</a>
                </span>
              
                <span class="taxonomy-tag">             
                    <i class="fa fa-tags fa-fw"></i>            
                    <a class="post-taxonomy-tag" href="https://diydeveloper.iotags/programming">programming</a>
                </span>
              
            
          
          </p>
      </div>
      
  </div>

</div>
        <p>Swift is Apple&rsquo;s clever new language. It is designed to be intuitive, modern, and read-able. Which it is, until you want to make a call to a C library - such as pcap.h.</p>

<p>PCap (Packet Capture) is a C library for sniffing network packets. I wanted to try some packet sniffing on my Mac, so a command line app written in Swift seemed like a good way to try out a new language.</p>

<h2 id="the-bridging-header">The Bridging Header</h2>

<p>To interoperate with C (and C-derivatives), Apple have the concept of a &ldquo;<a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/MixandMatch.html">Bridging Header</a>&rdquo;. A bridging header is simply a C header file referencing any libraries you need to have available in your Swift app.</p>

<p>To add one, add a new Objective-C file to your Project. XCode will prompt you to create a bridging header. Let it create one, then you can delete the objective-C file you added.</p>

<p>Here is my bridging header:</p>

<pre><code class="language-c">//
//  This nifty file lets us interop with C libraries
//  (or C++, or objective C if you have a fetish for square brackets)
//
#import &lt;pcap/pcap.h&gt;
</code></pre>

<p>With that in place, we can call <em>pcap</em>.</p>

<h2 id="calling-a-c-function">Calling a C function</h2>

<p>Let&rsquo;s make a call to pcap to create a new pcap session:</p>

<pre><code class="language-swift">
var error: UnsafeMutablePointer&lt;CChar&gt;
error = nil
let device = "en0"

// create a new pcap session via pcap.h
let pcapSession = pcap_create(device,error)
</code></pre>

<p>That&rsquo;s pretty standard stuff. XCode is smart enough to auto complete parameters for us, which is nice.</p>

<h2 id="calling-a-c-function-with-a-callback">Calling a C function with a callback</h2>

<p>Where it gets more interesting, is when we have a call back involved. Here is the header of the C function we want to call, along with the typedef:</p>

<pre><code class="language-swift">
int pcap_loop(pcap_t *p, int cnt, pcap_handler callback, u_char *user);
typedef void (*pcap_handler)(u_char *user, const struct pcap_pkthdr *h, const u_char *bytes);
</code></pre>

<p>In the code above, <em>pcap_handler</em> is the callback. So, how do we call pcap_loop from Swift? Back in the Swift 1.x days, you had to write your callback handlers in Objective-c - then call that Objective-C from your Swift class. In Swift <em>2.1</em> we can do it using <a href="http://fuckingclosuresyntax.com">closures</a>. A closure is simply a self contained block of code (and Apple have made the syntax a little confusing).</p>

<pre><code class="language-swift">
// here is the syntax
{(parameters being passed to closure) -> (returnType from closure) in statements}

// and here is how we use it
pcap_loop(pcapSession, numberOfPackets,
{
    (args: UnsafeMutablePointer&lt;u_char&gt;,
     pkthdr:UnsafePointer&lt;pcap_pkthdr&gt;,
     packet: UnsafePointer&lt;u_char&gt;) -&gt;Void in
            // our code goes here!
            print("packet received!")
},
nil)
</code></pre>

<p>So, in this case we are passing some arguments to <strong>pcap_loop</strong>. The 3rd argument is a closure (the pcap_handler in the C typedef). We pass pointers as parameters for the closure which pcap will assign things to. In our case, it assigns the packet header, the packet payload, and the third is used to pass data into the closure.</p>

<p>At this point, we can run our app, but all we are going to be able to do is print &ldquo;packet received!&rdquo; to the console. We can&rsquo;t do anything stateful, as our closure is contained (scoped) and can&rsquo;t access variables or properties outside its own scope.</p>

<h2 id="passing-data-to-our-closure">Passing data to our closure</h2>

<p>There are two ways we can go here. The first way is to pass something into the user argument of <em>pcap_loop</em>. That argument is passed to the call back function, and can be a reference to either a variable, or data structure.</p>

<p>The other approach is to reference an object outside of the closure scope. We could reference a global variable, but that isn&rsquo;t very elegant. The singleton pattern fits our need perfectly. It provides an object to maintain state of our packet capture session, and fits more with the style of Swift (vs pointer dereferencing).</p>

<p>Here is our singleton class:</p>

<pre><code class="language-swift">
class PacketAnalyser {

  // this is how we create a singleton in swift
  static let sharedInstance = PacketAnalyser()

  var packetCount: Int = 0;

  // This is a basic test, so lets just print the packet
  // count to the console
  func Process() {
      packetCount++
      print("Packet count " + packetCount.description)
  }
}
</code></pre>

<p>Here is how we call it from within our closure:</p>

<pre><code class="language-swift">
pcap_loop(pcapSession, numberOfPackets,
{
    (args: UnsafeMutablePointer&lt;u_char&gt;,
     pkthdr:UnsafePointer&lt;pcap_pkthdr&gt;,
     packet: UnsafePointer&lt;u_char&gt;) -&gt;Void in

            // singleton call
            let pa = PacketAnalyser.sharedInstance
            pa.Process()
},
nil)
</code></pre>

<p>Now you know how to call a C library from Swift with a callback. :)</p>

<p>You can find the test code here: <a href="https://github.com/dfrencham/swiftPCap">SwiftPcap on GitHub</a></p>

<p>Please leave a comment if this was helpful, or if you find any errors.</p>
        /eof
    </article>
</div>
        
      </div>
    
    
<div class="pure-g">
    <div class="pure-u-1">
      
      
      <nav class="pagination" role="pagination">
        
        <i style="color:lightgray;" class="fa fa-chevron-left"></i>
        
        <span>&nbsp;1 / 7&nbsp;</span>
        
        <a href="/page/2/"><i class="fa fa-chevron-right"></i></a>
        
      </nav>
    </div>
  </div>


    <div class="pure-g dashed-top">
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-2">
    
          <h3>Build It</h3>
          <ul>
            
            <li hugo-nav="/diy/2015/02/07/floating-floors/"><a href="https://diydeveloper.io/diy/2015/02/07/floating-floors/"> Floating Floors </a> </li>
            
            <li hugo-nav="/diy/2014/09/09/Concrete-Grinding-for-dummies/"><a href="https://diydeveloper.io/diy/2014/09/09/Concrete-Grinding-for-dummies/"> Concrete Floor Grinding for Dummies </a> </li>
            
          </ul>
    
          <h3>Fix It</h3>
          <ul>
            
            <li hugo-nav="/diy/2015/08/19/replace-your-exhaust-fan/"><a href="https://diydeveloper.io/diy/2015/08/19/replace-your-exhaust-fan/"> How to replace your exhaust fan </a> </li>
            
            <li hugo-nav="/diy/2015/07/12/how-to-plane-a-door/"><a href="https://diydeveloper.io/diy/2015/07/12/how-to-plane-a-door/"> How to plane a door </a> </li>
            
            <li hugo-nav="/diy/2015/05/26/how-to-replace-glass-door-rollers/"><a href="https://diydeveloper.io/diy/2015/05/26/how-to-replace-glass-door-rollers/"> How to replace glass door rollers </a> </li>
            
            <li hugo-nav="/diy/2015/01/08/childproofing-my-tv/"><a href="https://diydeveloper.io/diy/2015/01/08/childproofing-my-tv/"> Child proofing my TV </a> </li>
            
            <li hugo-nav="/diy/2014/11/24/repair-drywall-surface/"><a href="https://diydeveloper.io/diy/2014/11/24/repair-drywall-surface/"> Fix Dry Wall Surface </a> </li>
            
            <li hugo-nav="/diy/2014/11/16/replace-a-skylight-dome/"><a href="https://diydeveloper.io/diy/2014/11/16/replace-a-skylight-dome/"> Replace an old dome skylight </a> </li>
            
            <li hugo-nav="/tech/2014/07/07/replace-your-nexus4-screen/"><a href="https://diydeveloper.io/tech/2014/07/07/replace-your-nexus4-screen/"> Replace your Nexus 4 screen </a> </li>
            
            <li hugo-nav="/diy/2014/04/22/replacing-a-toilet-cistern/"><a href="https://diydeveloper.io/diy/2014/04/22/replacing-a-toilet-cistern/"> Replacing a toilet cistern </a> </li>
            
            <li hugo-nav="/diy/2014/04/16/installing-a-new-bathroom-basin/"><a href="https://diydeveloper.io/diy/2014/04/16/installing-a-new-bathroom-basin/"> Installing a new bathroom basin </a> </li>
            
            <li hugo-nav="/diy/2014/03/30/replacing-a-shower-head/"><a href="https://diydeveloper.io/diy/2014/03/30/replacing-a-shower-head/"> Replacing a shower head </a> </li>
            
          </ul>
        </div>
    
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-2">
          <h3>Code It</h3>
          <ul>
            
            <li hugo-nav="/post/2019-09-18-make-great-git-diagrams/"><a href="https://diydeveloper.io/post/2019-09-18-make-great-git-diagrams/"> Make great git diagrams </a> </li>
            
            <li hugo-nav="/tech/2015/11/27/swift-pcap/"><a href="https://diydeveloper.io/tech/2015/11/27/swift-pcap/"> Calling pcap from Swift (using a closure) </a> </li>
            
            <li hugo-nav="/tech/2015/08/10/knockout-web-components/"><a href="https://diydeveloper.io/tech/2015/08/10/knockout-web-components/"> Nestable knockout web components </a> </li>
            
            <li hugo-nav="/tech/2015/05/30/finding-a-javascript-performance-gremlin/"><a href="https://diydeveloper.io/tech/2015/05/30/finding-a-javascript-performance-gremlin/"> Finding a javascript performance gremlin </a> </li>
            
            <li hugo-nav="/tech/2015/04/30/microsoft-code/"><a href="https://diydeveloper.io/tech/2015/04/30/microsoft-code/"> My first few hours with Visual Studio Code </a> </li>
            
            <li hugo-nav="/tech/2015/04/27/accidental-npm/"><a href="https://diydeveloper.io/tech/2015/04/27/accidental-npm/"> Accidental NPM Packaging (and JSPM!) </a> </li>
            
            <li hugo-nav="/tech/2015/04/21/animating-aurelia/"><a href="https://diydeveloper.io/tech/2015/04/21/animating-aurelia/"> Animating Aurelia </a> </li>
            
            <li hugo-nav="/tech/2014/12/15/csharp6-new-features/"><a href="https://diydeveloper.io/tech/2014/12/15/csharp6-new-features/"> 3 Awesome New C# Features </a> </li>
            
            <li hugo-nav="/tech/2014/10/15/durandal-child-routers/"><a href="https://diydeveloper.io/tech/2014/10/15/durandal-child-routers/"> SPA within a SPA? Durandal child routers </a> </li>
            
            <li hugo-nav="/diy/2014/09/19/the-doctype-is-still-important/"><a href="https://diydeveloper.io/diy/2014/09/19/the-doctype-is-still-important/"> Yes, the doc-type is still important </a> </li>
            
          </ul>
    
          <h3>Tech Guides</h3>
          <ul>
            
            <li hugo-nav="/tech/2015/09/01/chromecast-ethernet/"><a href="https://diydeveloper.io/tech/2015/09/01/chromecast-ethernet/"> Add Ethernet to your ChromeCast for 12 bucks </a> </li>
            
            <li hugo-nav="/tech/2015/05/13/upgrading-windows-81-to-windows-10/"><a href="https://diydeveloper.io/tech/2015/05/13/upgrading-windows-81-to-windows-10/"> How to Upgrade Windows 8 to Windows 10 </a> </li>
            
            <li hugo-nav="/tech/2014/06/12/check-your-multicast-settings/"><a href="https://diydeveloper.io/tech/2014/06/12/check-your-multicast-settings/"> Chromecast issues? Check your Multicast settings </a> </li>
            
            <li hugo-nav="/tech/2014/06/07/how-i-got-burned-win8/"><a href="https://diydeveloper.io/tech/2014/06/07/how-i-got-burned-win8/"> How I Got Burned Today - Windows 8 Install </a> </li>
            
            <li hugo-nav="/tech/2014/05/26/chocolatey-package-manager/"><a href="https://diydeveloper.io/tech/2014/05/26/chocolatey-package-manager/"> Chocolatey - Package Management for Windows </a> </li>
            
            <li hugo-nav="/tech/2014/05/19/ocr-solar-meter-reader-part1/"><a href="https://diydeveloper.io/tech/2014/05/19/ocr-solar-meter-reader-part1/"> OCR Solar Meter Reader - Part 1 </a> </li>
            
            <li hugo-nav="/tech/2014/05/19/ocr-solar-meter-reader-part2/"><a href="https://diydeveloper.io/tech/2014/05/19/ocr-solar-meter-reader-part2/"> OCR Solar Meter Reader - Part 2 </a> </li>
            
            <li hugo-nav="/tech/2014/04/24/automatically-post-your-blog-to-social-media/"><a href="https://diydeveloper.io/tech/2014/04/24/automatically-post-your-blog-to-social-media/"> Automatically post your blog to social media </a> </li>
            
          </ul>
        </div>
      </div>
    </div>
    <div class="pure-u-md-1-4 pure-u-sm-1 right-col">
        <h3>About</h3>
        <div>
        Danny Frencham is a 30-something software developer, based in Brisbane Australia.
        </div>
        <h3>Projects</h3>
        <ul style="list-style: none; text-align: left; padding-left: 10px;">
          <li><a href="https://github.com/dfrencham/vscode-chutzpahrunner">vscode-chutzpahrunner</a></li>
          <li><a href="https://github.com/dfrencham/rad-gate">rad-gate</a></li>
        </ul>
        <h3>Tags</h3>
        <div class="tagcloud">
          
    
    
    
    
      
      
       
        
          
          <a href="/tags/html" class="tag-cloud-0" data-count=2>html</a>
        
      
    
      
      
       
        
          
          <a href="/tags/build-it" class="tag-cloud-1" data-count=6>build-it</a>
        
      
    
      
      
       
        
          
          <a href="/tags/C#" class="tag-cloud-1" data-count=3>C#</a>
        
      
    
      
      
       
        
          
          <a href="/tags/css" class="tag-cloud-1" data-count=5>css</a>
        
      
    
      
      
       
        
          
          <a href="/tags/plumbing" class="tag-cloud-1" data-count=3>plumbing</a>
        
      
    
      
      
       
        
          
          <a href="/tags/development" class="tag-cloud-2" data-count=7>development</a>
        
      
    
      
      
       
        
          
          <a href="/tags/visual-studio" class="tag-cloud-0" data-count=2>visual-studio</a>
        
      
    
      
      
       
        
          
          <a href="/tags/tools" class="tag-cloud-0" data-count=2>tools</a>
        
      
    
      
      
       
        
          
          <a href="/tags/programming" class="tag-cloud-4" data-count=17>programming</a>
        
      
    
      
      
       
        
          
          <a href="/tags/raspberry-pi" class="tag-cloud-0" data-count=2>raspberry-pi</a>
        
      
    
      
      
       
        
          
          <a href="/tags/blogging" class="tag-cloud-1" data-count=4>blogging</a>
        
      
    
      
      
       
        
          
          <a href="/tags/flooring" class="tag-cloud-0" data-count=2>flooring</a>
        
      
    
      
      
       
        
          
          <a href="/tags/reno" class="tag-cloud-0" data-count=2>reno</a>
        
      
    
      
      
       
        
          
          <a href="/tags/family" class="tag-cloud-0" data-count=2>family</a>
        
      
    
      
      
       
        
          
          <a href="/tags/door" class="tag-cloud-0" data-count=2>door</a>
        
      
    
      
      
       
        
          
          <a href="/tags/solar" class="tag-cloud-0" data-count=2>solar</a>
        
      
    
      
      
       
        
          
          <a href="/tags/automation" class="tag-cloud-0" data-count=2>automation</a>
        
      
    
      
      
       
        
          
          <a href="/tags/review" class="tag-cloud-1" data-count=5>review</a>
        
      
    
      
      
       
        
          
          <a href="/tags/meter" class="tag-cloud-0" data-count=2>meter</a>
        
      
    
      
      
       
        
          
          <a href="/tags/phone" class="tag-cloud-1" data-count=3>phone</a>
        
      
    
      
      
       
        
          
          <a href="/tags/javascript" class="tag-cloud-2" data-count=10>javascript</a>
        
      
    
      
      
       
        
          
          <a href="/tags/aurelia" class="tag-cloud-0" data-count=2>aurelia</a>
        
      
    
      
      
       
        
          
          <a href="/tags/tech-guide" class="tag-cloud-2" data-count=8>tech-guide</a>
        
      
    
      
      
       
        
          
          <a href="/tags/chromecast" class="tag-cloud-0" data-count=2>chromecast</a>
        
      
    
      
      
       
        
          
          <a href="/tags/ikea" class="tag-cloud-0" data-count=2>ikea</a>
        
      
    
      
      
       
        
          
          <a href="/tags/single-page-app" class="tag-cloud-0" data-count=2>single-page-app</a>
        
      
    
      
      
       
        
          
          <a href="/tags/how-I-got-burned-today" class="tag-cloud-0" data-count=2>how-I-got-burned-today</a>
        
      
    
      
      
       
        
          
          <a href="/tags/argh" class="tag-cloud-0" data-count=2>argh</a>
        
      
    
      
      
       
        
          
          <a href="/tags/dotnet" class="tag-cloud-1" data-count=3>dotnet</a>
        
      
    
      
      
       
        
          
          <a href="/tags/demolition" class="tag-cloud-1" data-count=3>demolition</a>
        
      
    
      
      
       
        
          
          <a href="/tags/ocr" class="tag-cloud-0" data-count=2>ocr</a>
        
      
    
      
      
       
        
          
          <a href="/tags/fix-it" class="tag-cloud-2" data-count=10>fix-it</a>
        
      
    
      
      
       
        
          
          <a href="/tags/networking" class="tag-cloud-0" data-count=2>networking</a>
        
      
    

        </div>
    </div>
  </div>
</section>

</article>
</div>
<script src="/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48772536-1', 'auto');
  ga('send', 'pageview');

</script>



<footer class="page-footer">
    <div class="pure-menu">
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-2">
            
              <a class="icon-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
            
              <a class="icon-link" href="/archive/"><i class='fa fa-list fa-fw'></i>Archive</a>
            
              <a class="icon-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
            
            <a class="icon-link" href="https://diydeveloper.io/index.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
            <a class="icon-link" href="https://github.com/dfrencham" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    
        </div>
        <div class="pure-u-1 pure-u-md-1-2 pure-u-lg-1-2">
            <div>
  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>
      Built with <a href="https://gohugo.io/" target="_blank">Hugo</a>
    </small>
  </div>
</div>

        </div>
    </div>
</footer>
</body>
</html>
